<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.3 $ -->
<!-- EN-Revision: 1.1 Maintainer: nobody Status: unknown -->
  <refentry id="function.sesam-query">
   <refnamediv>
    <refname>sesam_query</refname>
    <refpurpose>Durchführen einer SESAM-SQL-Abfrage und aufbereiten der Ergebnisse</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Beschreibung</title>
     <methodsynopsis>
      <type>string</type><methodname>sesam_query</methodname>
      <methodparam><type>string</type><parameter>query</parameter></methodparam>
      <methodparam choice="opt"><type>bool</type><parameter>scrollable</parameter></methodparam>
     </methodsynopsis>
    <para>
     Rückgabewerte: ein SESAM "result identifier" oder &false; 
     im Fehlerfall.
    </para>
    <para>
     Von anderen Funktionen wird "result_id" für Abfrage-Ergebnisse verwendet. 
    </para>
    <para>
     <function>sesam_query</function> schickt eine Abfrage an die aktuelle
     Datenbank auf dem Server. Sie kann sowohl "immediate" SQL-Anweisungen
     als auch "select type" Abfragen ausführen. Bei der Ausführung einer 
     "immediate" Anweisung ist kein Cursor aktiv und bei jedem folgenden
     <function>sesam_fetch_row</function> oder <function>sesam_fetch_result</function> call will return an empty
     Aufruf wird ein leeres Ergebnis (zero columns, indicating end-of-result) 
     zurückgeliefert.
     Für "select type" Anweisungen wird ein Ergebnis-Deskriptor und ein Cursor
     (scrollable oder sequential, abhängig vom optionalen
     bool <parameter>scrollable</parameter>-Parameter) zugewiesen.
     Wenn <parameter>scrollable</parameter> nicht angegeben wird, ist der 
     Cursor sequentiell.
    </para>
    <para>
     Bei der Verwendung von "scrollable" Cursors kann der Cursor
     im Ausgabesatz beliebig positioniert werden. Für jede "scrollable"
     Abfrage gibt es globale Standardwerte für den "scrolling"-Typ 
     (Initial-Wert: <literal>SESAM_SEEK_NEXT</literal>) und den
     scrolling offset, der entweder einmal durch 
     <function>sesam_seek_row</function> oder bei jedem Lesen
     einer Zeile mit <function>sesam_fetch_row</function>.
    </para>
    <para>
     Für "immediate" Befehle wird die Anzahl der betroffenen Zeilen für Abfragen
     von der Funktion <function>sesam_affected_rows</function> gesichert.
    </para>
    <para>
     Siehe auch: <function>sesam_fetch_row</function> und
     <function>sesam_fetch_result</function>.
     <example>
      <title>
       Zeige alle Zeilen der Tabelle "Telefon" als HTML-Tabelle
      </title>
      <programlisting role="php">
&lt;?php
if (!sesam_connect("phonedb", "demo", "otto"))
  die("cannot connect");
$result = sesam_query("select * from phone");
if (!$result) {
  $err = sesam_diagnostic();
  die($err["errmsg"]);
}
echo "&lt;TABLE BORDER&gt;\n";
// Add title header with column names above the result:
if ($cols = sesam_field_array($result)) {
  echo " &lt;TR&gt;&lt;TH COLSPAN=".$cols["count"]."&gt;Result:&lt;/TH&gt;&lt;/TR&gt;\n";
  echo " &lt;TR&gt;\n";
  for ($col = 0; $col &lt; $cols["count"]; ++$col) {
    $colattr = $cols[$col];
    /* Span the table head over SESAM's "Multiple Fields": */
    if ($colattr["count"] &gt; 1) {
      echo "  &lt;TH COLSPAN=".$colattr["count"]."&gt;".$colattr["name"].
           "(1..".$colattr["count"].")&lt;/TH&gt;\n";
      $col += $colattr["count"] - 1;
    }
    else
      echo "  &lt;TH&gt;" . $colattr["name"] . "&lt;/TH&gt;\n";
  }
  echo " &lt;/TR&gt;\n";
}

do {
  // Fetch the result in chunks of 100 rows max.
  $ok = sesam_fetch_result($result,100);
  for ($row=0; $row &lt; $ok["rows"]; ++$row) {
    echo " &lt;TR&gt;\n";
    for ($col = 0; $col &lt; $ok["cols"]; ++$col) {
      if (isset($ok[$col][$row]))
        echo "  &lt;TD&gt;" . $ok[$col][$row] . "&lt;/TD&gt;\n";
      else
        echo "  &lt;TD&gt;-empty-&lt;/TD&gt;\n";
    }
    echo " &lt;/TR&gt;\n";
  }
} while ($ok["truncated"]); // while there may be more data
echo "&lt;/TABLE&gt;\n";
// free result id
sesam_free_result($result);
?&gt;
      </programlisting>
     </example>
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

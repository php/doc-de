<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.1 $ -->
<!-- EN-Revision: 1.12 Maintainer: samesch Status: ready -->
<!-- splitted from ./en/functions/pcre.xml, last change in rev 1.2 -->
  <refentry id="function.preg-replace">
   <refnamediv>
    <refname>preg_replace</refname>
    <refpurpose>Sucht und ersetzt einen regulären Ausdruck</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Beschreibung</title>
     <methodsynopsis>
      <type>mixed</type><methodname>preg_replace</methodname>
      <methodparam><type>mixed</type><parameter>Suchmuster</parameter></methodparam>
      <methodparam><type>mixed</type><parameter>Ersatz</parameter></methodparam>
      <methodparam><type>mixed</type><parameter>Zeichenkette</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>Limit</parameter></methodparam>
     </methodsynopsis>
    <para>
     Durchsucht <parameter>Zeichenkette</parameter> nach Übereinstimmungen mit
     <parameter>Suchmuster</parameter> und ersetzt sie mit
     <parameter>Ersatz</parameter>. Falls <parameter>Limit</parameter>
     angegeben wurde, werden nur <parameter>Limit</parameter>
     Übereinstimmungen ersetzt. Wird <parameter>Limit</parameter> weggelassen
     oder ist es -1, dann werden alle Übereinstimmungen ersetzt.
    </para>
    <para>
     <parameter>Ersatz</parameter> darf Referenzen in der Form
     <literal>\\<replaceable>n</replaceable></literal> oder (seit
     PHP 4.0.4) <literal><replaceable>$n</replaceable></literal> enthalten,
     wobei Letztere vorzuziehen ist. Jede dieser Referenzen wird mit dem Text
     ersetzt, der vom <replaceable>n</replaceable>-ten eingeklammerten
     Suchmuster erfasst wurde. <replaceable>n</replaceable> kann einen Wert
     von 0 bis 99 haben. <literal>\\0</literal> oder <literal>$0</literal>
     beziehen sich auf den Text, der mit dem kompletten Suchmuster
     übereinstimmt. Um die Nummer des erfassenden Teil-Suchmusters zu
     erhalten, werden öffnende Klammern mit 1 beginnend von links nach rechts
     gezählt.
    </para>
    <para>
     Wenn Sie mit einer Ersetzung arbeiten wollen, in der auf eine
     Rückreferenzierung direkt eine weitere Zahl folgt (d.h., direkt nach der
     Übereinstimmmung mit einem Suchmuster soll eine Zahl kommen), können Sie
     für Ihre Rückreferenzierung nicht die Schreibweise <literal>\\1</literal>
     verwenden. So würde z.B. <literal>\\11</literal> die Funktion
     <function>preg_replace</function> verwirren, weil sie nicht weiß, ob Sie die
     Rückreferenzierung <literal>\\1</literal> gefolgt von der Zahl
     <literal>1</literal> wollen oder nur die Rückreferenzierung
     <literal>\\11</literal>. In diesem Fall ist die Lösung,
     <literal>\${1}1</literal> zu verwenden. Damit wird eine isolierte
     Rückreferenzierung <literal>$1</literal> erzeugt und die
     <literal>1</literal> bleibt ein Zahlensymbol.
    </para>
    <para>
     <example>
      <title>
       Die Verwendung von Rückreferenzierungen mit darauf folgenden
       numerischen Literalen
      </title>
      <programlisting role="php">
<![CDATA[
<?php
$zeichenkette = "15. April 2003";
$suchmuster = "/(\d+)\. (\w+) (\d+)/i";
$ersetzung = "\${2}1,\$3";
echo preg_replace($suchmuster, $ersetzung, $zeichenkette);
?>
]]>
      </programlisting>
      <para>
       Dieses Beispiel erzeugt folgende Ausgabe:
      </para>
      <screen>
<![CDATA[
April1,2003
]]>
      </screen>
     </example>
    </para>
    <para>
     Falls Übereinstimmungen gefunden werden, wird die neue
     <parameter>Zeichenkette</parameter> zurückgegeben, andernfalls wird
     <parameter>Zeichenkette</parameter> unverändert zurückgegeben.
    </para>
    <para>
     Außer <parameter>Limit</parameter>, kann jeder Parameter, der an
     <function>preg_replace</function> übergeben wird, ein eindimensionales
     Array sein. Bei Verwendung von Arrays für
     <parameter>Suchmuster</parameter> und <parameter>Ersatz</parameter>
     werden die Schlüssel in der Reihenfolge bearbeitet, in der sie im Array
     vorliegen. Das ist <emphasis>nicht notwendigerweise</emphasis> dieselbe,
     wie die numerische Reihenfolge der Indizes. Wenn Sie Indizes verwenden,
     um festzulegen welches <parameter>Suchmuster</parameter> durch welchen
     <parameter>Ersatz</parameter> ersetzt werden soll, sollten Sie vor dem
     Aufruf von <function>preg_replace</function> <function>ksort</function>
     auf jedes Array anwenden.
    </para>
    <para>
     <example>
      <title>
       Die Verwendung von <function>preg_replace</function> mit indizierten
       Arrays
      </title>
      <programlisting role="php">
<![CDATA[
<?php
$zeichenkette = "Der schnelle braune Fuchs sprang über den faulen Hund.";

$suchmuster[0] = "/schnelle/";
$suchmuster[1] = "/braune/";
$suchmuster[2] = "/Fuchs/";

$ersetzungen[2] = "Bär";
$ersetzungen[1] = "schwarze";
$ersetzungen[0] = "langsame";

echo preg_replace($suchmuster, $ersetzungen, $zeichenkette);
?>
]]>
      </programlisting>
      <para>
       Ausgabe:
      </para>
      <screen>
<![CDATA[
Der Bär schwarze langsame sprang über den faulen Hund.
]]>
      </screen>
      <para>
       Wenn wir Suchmuster und Ersetzungen mit <function>ksort</function>
       sortieren, sollten wir bekommen was wir wollten.
      </para>
      <programlisting role="php">
<![CDATA[
<?php

ksort($suchmuster);
ksort($ersetzungen);

echo preg_replace($suchmuster, $ersetzungen, $zeichenkette);

?>
]]>
      </programlisting>
      <para>
       Ausgabe:
      </para>
      <screen>
<![CDATA[
Der langsame schwarze Bär sprang über den faulen Hund.
]]>
      </screen>
     </example>
    </para>
    <para>
     Falls <parameter>Zeichenkette</parameter> ein Array ist, wird das Suchen
     und Ersetzen auf jedes Element von <parameter>Zeichenkette</parameter>
     angewandt und der Rückgabewert ist ebenfalls ein Array.
    </para>
    <para>
     Falls <parameter>Suchmuster</parameter> und <parameter>Ersatz</parameter>
     Arrays sind, nimmt <function>preg_replace</function> jeweils einen Wert
     von jedem Array und verwendet sie für das Suchen und Ersetzen in
     <parameter>Zeichenkette</parameter>. Wenn <parameter>Ersatz</parameter>
     weniger Elemente hat als <parameter>Suchmuster</parameter>, wird für die
     restlichen Ersetzungen die leere Zeichenkette verwendet. Ist
     <parameter>Suchmuster</parameter> ein Array und
     <parameter>Ersatz</parameter> eine Zeichenkette, dann wird diese
     Zeichenkette für jeden Wert von <parameter>Suchmuster</parameter>
     verwendet. Der umgekehrte Fall hätte wohl keinen Sinn.
    </para>
    <para>
     Mit dem Modifikator <literal>/e</literal> wird der Parameter
     <parameter>Ersatz</parameter> nach den entsprechenden Ersetzungen der
     Referenzen von <function>preg_replace</function> wie PHP-Code behandelt.
     Tipp: Stellen Sie sicher, dass <parameter>Ersatz</parameter> gültigen
     PHP-Code erzeugt, weil sich PHP sonst über einen Syntaxfehler (parse
     error) in der Zeile beschwert, die den Aufruf von
     <function>preg_replace</function> enthält.
    </para>
    <para>
     <example>
      <title>Ersetzen mehrerer Werte</title>
      <programlisting role="php">
<![CDATA[
<?php
$suchmuster = array ("/(19|20)(\d{2})-(\d{1,2})-(\d{1,2})/",
                   "/^\s*{(\w+)}\s*=/");
$ersetzen = array ("\\4.\\3.\\1\\2", "$\\1 =");
echo preg_replace($suchmuster, $ersetzen, "{startDatum} = 1999-5-27");
?>
]]>
      </programlisting>
      <para>
       Dieses Beispiel erzeugt:
      </para>
      <screen>
<![CDATA[
$startDatum = 27.5.1999
]]>
      </screen>
     </example>
    </para>
    <para>
     <example>
      <title>Die Verwendung des Modifikators /e</title>
      <programlisting role="php">
<![CDATA[
<?php
preg_replace("/(<\/?)(\w+)([^>]*>)/e", 
              "'\\1'.strtoupper('\\2').'\\3'", 
              $html_body);
?>
]]>
      </programlisting>
      <para>
       Das wandelt alle HTML-Tags des durchsuchten Textes in Großbuchstaben
       um.
      </para>
     </example>
    </para>
    <para>
     <example>
      <title>HTML in Text umwandeln</title>
      <programlisting role="php">
<![CDATA[
<?php
// $dokument sollte ein HTML-Dokument enthalten.
// Folgendes entfernt HTML-Tags, JavaScript-Abschnitte
// und Leerräume. Außerdem wandelt es ein paar gängige
// HTML-Entitäten in ihr Text-Äquivalent um.

$suche = array ("'<script[^>]*?>.*?</script>'si",  // JavaScript entfernen
                "'<[\/\!]*?[^<>]*?>'si",           // HTML-Tags entfernen
                "'([\r\n])[\s]+'",                 // Leerräume entfernen
                "'&(quot|#34);'i",                 // HTML-Entitäten ersetzen
                "'&(amp|#38);'i",
                "'&(lt|#60);'i",
                "'&(gt|#62);'i",
                "'&(nbsp|#160);'i",
                "'&(iexcl|#161);'i",
                "'&(cent|#162);'i",
                "'&(pound|#163);'i",
                "'&(copy|#169);'i",
                "'&#(\d+);'e");                    // als PHP auswerten

$ersetze = array ("",
                  "",
                  "\\1",
                  "\"",
                  "&",
                  "<",
                  ">",
                  " ",
                  chr(161),
                  chr(162),
                  chr(163),
                  chr(169),
                  "chr(\\1)");

$text = preg_replace($suche, $ersetze, $dokument);
?>
]]>
      </programlisting>
     </example>
    </para>
    <note>
     <para>
      Der Parameter <parameter>Limit</parameter> wurde nach PHP 4.0.1pl2
      hinzugefügt.
     </para>
    </note>
    <para>
     Siehe auch <function>preg_match</function>,
     <function>preg_match_all</function> und <function>preg_split</function>.
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->

<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.3 $ -->
 <reference id="ref.pdf">
  <title>PDF Funktionen</title>
  <titleabbrev>PDF</titleabbrev>
  <partintro>
   <section id="pdf.intro">
    <title>Einleitung</title>
    <simpara>
     Mit Hilfe der PDF-Bibliothek von Thomas Merz können mit PHP PDF
     Dateien erzeugt werden. Die Bibliothek ist unter <ulink
     url="&url.pdf;">&url.pdf;</ulink>; verfügbar. Zudem sind noch zwei
     weitere Bibliotheken notwendig, <ulink url="&url.jpeg;">die JPEG
     Bibliothek</ulink> und <ulink url="&url.tiff;">die TIFF
     Bibliothek</ulink>, um PHP zu übersetzen.  Diese beiden Bibliothek
     bereiten häufig Probleme bei der Konfiguration von PHP. Sie
     sollten unbedingt die Meldungen des Konfigurations-Skripts
     befolgen, um aufkommende Probleme zu lösen.
    </simpara>
    <simpara>
     Beachten sie zudem die excellente Dokumentation die mit pdflib
     ausgeliefert wird. Sie gibt einen guten Überblick über die
     Möglichkeiten von pdflib.
    </simpara>
    <simpara>
     Die meisten Funktionen in pdflib sind in ähnlicher Form auch in
     PHP vorhanden. Die Parameter sind in der Regel auch identisch.
     Sie sollten zudem die Grundkonzepte von PDF und Postscript
     verstanden haben, um das PDF Module effizient nutzen zu können.
    </simpara>
    <simpara>
     Alle Längen und Koordinatenangaben sind in Postscript-Punkten
     gemessen.  Für gewöhnlich entsprechen 72 PostScript-Punkte 1 Inch,
     was jedoch von der Auflösung des Ausgabegeräts abhängt.
    </simpara>

    <simpara>
     Neben diesem Modul gibt es noch ein weiteres zur Erzeugung von
     PDF-Dateien basierend auf der Bibliothek ClibPDF von
     <ulink url="&url.cpdf;">FastIO</ulink>.
     Es hat eine geringfügig andere Programmierschnittstelle.
     Schauen Sie in die
     <link linkend="ref.cpdf">Funktionsübersicht</link> für
     weitere Details.
    </simpara>
    <simpara> 
     Das PDF Module von PHP verwendet einen neuen Type von Variable
     Er wird 
     <parameter>pdfdoc</parameter> genannt. 
     <parameter>pdfdoc</parameter> ist ein Zeiger auf das PDF Dokument und
     wird bei fast allen Funktion als erster Parameter erwartet.
    </simpara>

   </section>
   <section id="pdf.oldlibs.confusion">
    <title>Altlasten</title>
    <para>
     Since the very begining of PDF support in PHP &mdash; starting with
     pdflib 0.6 &mdash;
     there has been tons of changes especially to the pdflib API. Most of
     these changes has been somehow covered by PHP, some has even required
     changes to the PHP API. Since pdflib
     3.x the API seems to be stabilzed and PHP4 has adopted the version as a
     minimum requirement for PDF support. The consequence will be that many
     functions will disappear or be replaced by alternatives sooner or later. 
     Support for pdflib 0.6 is already completely given up.
     The following table list all the functions which are deprecated
     in PHP 4.02 and should be replaced by their new versions.
    </para>
    <para>
     <table>
      <title>Deprecated functions and its replacements</title>
      <tgroup cols="2">
       <thead>
        <row>
         <entry>Old function</entry>
         <entry>Replacement</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry><function>pdf_put_image</function></entry>
         <entry>Not needed anymore.</entry>
        </row>
        <row>
         <entry><function>pdf_get_font</function></entry>
         <entry><function>pdf_get_value</function> passing
         <literal>"font"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_get_fontsize</function></entry>
         <entry><function>pdf_get_value</function> passing 
                  <literal>"fontsize"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_get_fontname</function></entry>
         <entry><function>pdf_get_parameter</function>  passing    
         <literal>"fontname"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_info_creator</function></entry>
         <entry><function>pdf_set_info</function> passing    
         <literal>"Creator"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_info_title</function></entry>
         <entry><function>pdf_set_info</function> passing
         <literal>"Title"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_info_subject</function></entry>
         <entry><function>pdf_set_info</function> passing
         <literal>"Subject"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_info_author</function></entry>
         <entry><function>pdf_set_info</function> passing
         <literal>"Author"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_info_keywords</function></entry>
         <entry><function>pdf_set_info</function> passing
         <literal>"Keywords"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_leading</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"leading"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_text_rendering</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"textrendering"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_text_rise</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"textrise"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_horiz_scaling</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"horizscaling"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_text_matrix</function></entry>
         <entry>Not available anymore</entry>
        </row>
        <row>
         <entry><function>pdf_set_char_spacing</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"charspacing"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_word_spacing</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"wordspacing"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_transition</function></entry>
         <entry><function>pdf_set_parameter</function> passing
         <literal>"transition"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_set_duration</function></entry>
         <entry><function>pdf_set_value</function> passing
         <literal>"duration"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_open_gif</function></entry>
         <entry><function>pdf_open_image_file</function> passing
         <literal>"gif"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_open_jpeg</function></entry>
         <entry><function>pdf_open_image_file</function> passing
         <literal>"jpeg"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_open_tiff</function></entry>
         <entry><function>pdf_open_image_file</function> passing
         <literal>"tiff"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_open_png</function></entry>
         <entry><function>pdf_open_image_file</function> passing
         <literal>"png"</literal> as the second parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_get_imagewidth</function></entry>
         <entry><function>pdf_get_value</function> passing
         <literal>"imagewidth"</literal> as the second parameter and the image
         as the third parameter.</entry>
        </row>
        <row>
         <entry><function>pdf_get_imageheight</function></entry>
         <entry><function>pdf_get_value</function> passing
         <literal>"imageheight"</literal> as the second parameter and the
         image as the third parameter.</entry>
        </row>
        <row>
         <entry><function></function></entry>
         <entry><function></function></entry>
        </row>
       </tbody>
      </tgroup>
     </table>
    </para>
   </section>
   <section id="pdf.install.pdflib">
    <title>Tips zur Installation von pdflib 3.x</title>
    <simpara>
     Seit Version 3.0 von pdflib sollten sie pdflib mit der configure-Option
     <literal>--enable-shared-pdflib</literal> konfigurieren.
    </simpara>
   </section>

   <section id="pdf.oldlibs.hints">
    <title>Verwenden alter pdflib Versionen</title>
    <simpara>
     Mit Version 2.20 von pdflib wurden einige Veränderungen an der API
     vorgenommen. Zudem ist Unterstützung für asiatische Zeichensätze
     hinzugekommen. Dies hat leider auch zu Änderungen am php4-Modul
     geführt (nicht php3). Wenn Sie pdflib 2.20 benutzen, dann sollten
     Sie die Erzeugung von Dokumenten im Speicher mit Vorsicht benutzen.
     Bis zur entgültigen Version 3.0 von pdflib könnte dies instabil sein.
     Der encoding Parameter der Funktion <function>pdf_set_font</function>
     hat sich in eine Zeichenkette geändert. Dies bedeutet, dass anstatt
     von beispielsweise 4 jetzt 'winansi' verwendet werden muss.
    </simpara>
    <simpara>
     Wenn Sie die Version 2.30 von pdflib verwenden, dann steht Ihnen
     die Funktion <function>pdf_set_text_matrix</function> nicht mehr
     zur Verfügung. Diese Funktion wurde komplett entfernt. Grundsätzlich
     ist es ratsam die release notes der verwendeten Version von pdflib
     zu lesen.
    </simpara>
    <simpara>
     Versionen von PHP4 die nach dem 9. März 2000 erscheinen unterstützen
     nur noch die Versionen &gt;3.0 von pdflib. PHP3 sollte hingegen nicht
     mit Versionen &gt;2.01 verwendet werden.
    </simpara>
    <simpara>
     Bei Gebrauch von pdflib 2.01 sollte überprüft werden, ob die
     Bibliothek richtig installiert wurde.  Es sollte die Datei oder
     ein Verweis libpdf.so im Installationsverzeichnis von pdflib
     existieren. Version 2.01 erzeugt nur die Bibliothek mit dem Namen
     libpdf2.01.so, die so nicht vom Linker des Systems gefunden werden
     kann. In diesem Fall müssen Sie den Verweis von libpdf.so nach
     libpdf2.01.so selbst anlegen.
    </simpara>
   </section>

   <section id="pdf.examples">
    <title>Beispiele</title>
    <para>
     Die meisten Funktionen sind sehr einfach zu benutzen. Das Schwierigste
     wird wohl sein, überhaupt ein einfaches PDF-Dokument zu erstellen.
     Das folgende Beispiel soll die ersten Schritte erleichtern.
     Dieses Skript erstellt die PDF-Datei <filename>test.pdf</filename>,
     welche nur aus einer Seite besteht.
     Auf der Seite befindet sich der Text "Times Roman outlined" in einem
     outlined, 30pt Zeichensatz. Der Text ist zudem unterstrichen.
    </para>
    <para>
     <example>
      <title>Erstellung eines PDF Dokuments mit pdflib</title>
      <programlisting>
&lt;?php
$fp = fopen("test.pdf", "w");
$pdf = pdf_open($fp);
pdf_set_info_author($pdf, "Uwe Steinmann");
pdf_set_info_title($pdf, "Test for PHP wrapper of PDFlib 2.0");
pdf_set_info_author($pdf, "Name of Author");
pdf_set_info_creator($pdf, "See Author");
pdf_set_info_subject($pdf, "Testing");
pdf_begin_page($pdf, 595, 842);
pdf_add_outline($pdf, "Page 1");
pdf_set_font($pdf, "Times-Roman", 30, 4);
pdf_set_text_rendering($pdf, 1);
pdf_show_xy($pdf, "Times Roman outlined", 50, 750);
pdf_moveto($pdf, 50, 740);
pdf_lineto($pdf, 330, 740);
pdf_stroke($pdf);
pdf_end_page($pdf);
pdf_close($pdf);
fclose($fp);
echo "&lt;A HREF=getpdf.php>finished&lt;/A>";
?>
      </programlisting>
      <simpara>
       Das PHP-Skript <filename>getpdf.php</filename> liefert nur das PDF-Dokument.
      </simpara>
      <informalexample>
       <programlisting>
&lt;?php
$fp = fopen("test.pdf", "r");
header("Content-type: application/pdf");
fpassthru($fp);
fclose($fp);
?>
       </programlisting>
      </informalexample>
     </example>
    </para>
    <para>
     Die pdflib-Distribution enthält ein komplizierteres Beispiel,
     welches ein Reihe Seiten erstellt die jeweils eine analoge Uhr
     mit der aktuellen Uhrzeit enthalten. Dieses Beispiel in ein
     PHP-Skript umgesetzt sieht wie folgt aus (das gleiche Beispiel wird
     auch in der Dokumentation zum 
     <link linkend="ref.cpdf">cpdf Modul</link> verwendet): 
    </para>
    <para>
     <example>
      <title>pdfclock Beispiel aus der pdflib Distribution</title>
      <programlisting>
&lt;?php
$pdffilename = "clock.pdf";
$radius = 200;
$margin = 20;
$pagecount = 40;

$fp = fopen($pdffilename, "w");
$pdf = pdf_open($fp);
pdf_set_info_creator($pdf, "pdf_clock.php3");
pdf_set_info_author($pdf, "Uwe Steinmann");
pdf_set_info_title($pdf, "Analog Clock");

while($pagecount-- > 0) {
    pdf_begin_page($pdf, 2 * ($radius + $margin), 2 * ($radius + $margin));

    pdf_set_transition($pdf, 4);  /* wipe */ 
    pdf_set_duration($pdf, 0.5);
  
    pdf_translate($pdf, $radius + $margin, $radius + $margin);
    pdf_save($pdf);
    pdf_setrgbcolor($pdf, 0.0, 0.0, 1.0);

    /* minute strokes */
    pdf_setlinewidth($pdf, 2.0);
    for ($alpha = 0; $alpha &lt; 360; $alpha += 6) {
        pdf_rotate($pdf, 6.0);
        pdf_moveto($pdf, $radius, 0.0);
        pdf_lineto($pdf, $radius-$margin/3, 0.0);
        pdf_stroke($pdf);
    }

    pdf_restore($pdf);
    pdf_save($pdf);

    /* 5 minute strokes */
    pdf_setlinewidth($pdf, 3.0);
    for ($alpha = 0; $alpha &lt; 360; $alpha += 30) { 
        pdf_rotate($pdf, 30.0);
        pdf_moveto($pdf, $radius, 0.0);
        pdf_lineto($pdf, $radius-$margin, 0.0);
        pdf_stroke($pdf);
    }

    $ltime = getdate();

    /* draw hour hand */
    pdf_save($pdf);
    pdf_rotate($pdf,-(($ltime['minutes']/60.0)+$ltime['hours']-3.0)*30.0);
    pdf_moveto($pdf, -$radius/10, -$radius/20);
    pdf_lineto($pdf, $radius/2, 0.0);
    pdf_lineto($pdf, -$radius/10, $radius/20);
    pdf_closepath($pdf);
    pdf_fill($pdf);
    pdf_restore($pdf);

    /* draw minute hand */
    pdf_save($pdf);
    pdf_rotate($pdf,-(($ltime['seconds']/60.0)+$ltime['minutes']-15.0)*6.0);
    pdf_moveto($pdf, -$radius/10, -$radius/20);
    pdf_lineto($pdf, $radius * 0.8, 0.0);
    pdf_lineto($pdf, -$radius/10, $radius/20);
    pdf_closepath($pdf);
    pdf_fill($pdf);
    pdf_restore($pdf);

    /* draw second hand */
    pdf_setrgbcolor($pdf, 1.0, 0.0, 0.0);
    pdf_setlinewidth($pdf, 2);
    pdf_save($pdf);
    pdf_rotate($pdf, -(($ltime['seconds'] - 15.0) * 6.0));
    pdf_moveto($pdf, -$radius/5, 0.0);
    pdf_lineto($pdf, $radius, 0.0);
    pdf_stroke($pdf);
    pdf_restore($pdf);

    /* draw little circle at center */
    pdf_circle($pdf, 0, 0, $radius/30);
    pdf_fill($pdf);

    pdf_restore($pdf);

    pdf_end_page($pdf);
}

$pdf = pdf_close($pdf);
fclose($fp);
echo "&lt;A HREF=getpdf.php?filename=".$pdffilename.">finished&lt;/A>";
?>
      </programlisting>
      <simpara>
       Das PHP-Skript <filename>getpdf.php</filename> liefert wiederum nur
       das Dokument.
      </simpara>
      <programlisting>
&lt;?php
$fp = fopen($filename, "r");
header("Content-type: application/pdf");
fpassthru($fp);
fclose($fp);
?>
      </programlisting>
     </example>
    </para>
   </section>
  </partintro>

&reference.pdf.functions;

 </reference>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->

